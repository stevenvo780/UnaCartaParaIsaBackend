# ๐ง Arquitectura y Flujos del Sistema de IA de Agentes

---

## ๐ Arquitectura del Ciclo de IA

```text
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        MULTI-RATE SCHEDULER                                 โ
โ  โโโโโโโโโโโโโโโ   โโโโโโโโโโโโโโโ   โโโโโโโโโโโโโโโ                        โ
โ  โ  FAST 50ms  โ   โ MEDIUM 250msโ   โ  SLOW 1000msโ                        โ
โ  โ โโโโโโโโโโโ โ   โ โโโโโโโโโโโ โ   โ โโโโโโโโโโโ โ                        โ
โ  โ Movement    โ   โ AISystem    โ   โ Economy     โ                        โ
โ  โ Combat      โ   โ Needs       โ   โ Market      โ                        โ
โ  โ             โ   โ Social      โ   โ Governance  โ                        โ
โ  โ             โ   โ Household   โ   โ Production  โ                        โ
โ  โ             โ   โ LifeCycle   โ   โ Building    โ                        โ
โ  โ             โ   โ Time        โ   โ Crafting    โ                        โ
โ  โ             โ   โ Role        โ   โ WorldRes    โ                        โ
โ  โ             โ   โ Task        โ   โ             โ                        โ
โ  โ             โ   โ Animal      โ   โ             โ                        โ
โ  โโโโโโโโโโโโโโโ   โโโโโโโโโโโโโโโ   โโโโโโโโโโโโโโโ                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                   โ
                                   โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                          AISystem.update()                                 โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ 1. Proceso por lotes (BATCH_SIZE = 2 agentes/tick)                     โ โ
โ  โ 2. Para cada agente:                                                  โ โ
โ  โ    โโโ Verificar si playerControlled โ SKIP                           โ โ
โ  โ    โโโ Verificar si offDuty โ SKIP                                    โ โ
โ  โ    โโโ Verificar si isDead โ SKIP                                     โ โ
โ  โ    โโโ processAgent()                                                 โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                   โ
                                   โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        processAgent(agentId, aiState, now)                 โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ 1. IF currentGoal exists:                                              โ โ
โ  โ    โโโ isGoalCompleted? โ completeGoal() โ shift queue                 โ โ
โ  โ    โโโ isGoalInvalid? โ failGoal() โ clear goal                        โ โ
โ  โ    โโโ hasCurrentAction? โ RETURN (esperar)                            โ โ
โ  โ                                                                        โ โ
โ  โ 2. prePlanGoals() - Llenar cola de objetivos (MAX_QUEUED_GOALS = 3)    โ โ
โ  โ                                                                        โ โ
โ  โ 3. IF no currentGoal:                                                  โ โ
โ  โ    โโโ Tomar de goalQueue si existe                                    โ โ
โ  โ    โโโ makeDecision() โ planGoals() โ seleccionar mejor                โ โ
โ  โ                                                                        โ โ
โ  โ 4. IF currentGoal vรกlido:                                              โ โ
โ  โ    โโโ Validar objetivo antes de ejecutar                              โ โ
โ  โ    โโโ IF isMoving โ RETURN                                            โ โ
โ  โ    โโโ planAction() โ AIActionPlanner                                  โ โ
โ  โ    โโโ executeAction() โ AIActionExecutor                              โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
````

---

## ๐ฏ Flujo de Planificaciรณn de Objetivos (AgentGoalPlanner)

```text
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        planGoals(deps, aiState, now)                       โ
โ                                                                            โ
โ  EVALUADORES (ejecutados en secuencia):                                    โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ 1. BiologicalDriveEvaluator    โ SATISFY_HUNGER/THIRST/ENERGY          โ โ
โ  โ    โโโ IF priority > 0.9 โ RETURN [criticalGoal] (corte temprano)      โ โ
โ  โ    โโโ Threshold: < 40 = urgente                                       โ โ
โ  โ                                                                        โ โ
โ  โ 2. ReproductionEvaluator       โ REPRODUCE                             โ โ
โ  โ                                                                        โ โ
โ  โ 3. SocialDriveEvaluator        โ SATISFY_SOCIAL/FUN                    โ โ
โ  โ                                                                        โ โ
โ  โ 4. CognitiveDriveEvaluator     โ WORK, EXPLORE                         โ โ
โ  โ                                                                        โ โ
โ  โ 5. CollectiveNeedsEvaluator    โ Necesidades de la comunidad           โ โ
โ  โ                                                                        โ โ
โ  โ 6. CombatEvaluator             โ ATTACK, FLEE, COMBAT                  โ โ
โ  โ    โโโ IF combat priority > 0.7 โ RETURN [combatGoal] (corte temprano) โ โ
โ  โ    โโโ Evalรบa estrategia: peaceful/tit_for_tat/bully                   โ โ
โ  โ                                                                        โ โ
โ  โ 7. AssistEvaluator             โ ASSIST (ayudar otros agentes)         โ โ
โ  โ                                                                        โ โ
โ  โ 8. ConstructionEvaluator       โ CONSTRUCTION                          โ โ
โ  โ                                                                        โ โ
โ  โ 9. DepositEvaluator            โ DEPOSIT (depositar recursos)          โ โ
โ  โ                                                                        โ โ
โ  โ 10. CraftingEvaluator          โ CRAFT                                 โ โ
โ  โ                                                                        โ โ
โ  โ 11. QuestEvaluator             โ QUEST                                 โ โ
โ  โ                                                                        โ โ
โ  โ 12. TradeEvaluator             โ TRADE                                 โ โ
โ  โ                                                                        โ โ
โ  โ 13. BuildingContributionEval   โ BUILD (contribuir a edificios)        โ โ
โ  โ                                                                        โ โ
โ  โ 14. AttentionEvaluator         โ EXPLORE (atenciรณn/exploraciรณn)        โ โ
โ  โ                                                                        โ โ
โ  โ 15. OpportunitiesEvaluator     โ WORK, EXPLORE (oportunidades)         โ โ
โ  โ     (Solo si criticalCount == 0)                                       โ โ
โ  โ                                                                        โ โ
โ  โ 16. ExpansionEvaluator         โ EXPAND (expansiรณn territorio)         โ โ
โ  โ                                                                        โ โ
โ  โ 17. DefaultExploration         โ EXPLORE (fallback si goals vacรญo)     โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                            โ
โ  FINAL: prioritizeGoals() โ ordenar por prioridad โ retornar top 5        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## โก Flujo de Acciones (AIActionPlanner)

```text
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     planAction(agentId, goal) โ AgentAction                โ
โ                                                                            โ
โ  GOAL TYPE                    โ  ACTION TYPE                               โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  SATISFY_NEED                 โ  HARVEST / MOVE / IDLE                     โ
โ  SATISFY_HUNGER               โ  HARVEST / MOVE / IDLE                     โ
โ  SATISFY_THIRST               โ  HARVEST / MOVE / IDLE                     โ
โ  SATISFY_ENERGY               โ  SLEEP / MOVE / IDLE                       โ
โ  SATISFY_SOCIAL               โ  SOCIALIZE / MOVE                          โ
โ  SATISFY_FUN                  โ  SOCIALIZE / MOVE                          โ
โ  GATHER                       โ  HARVEST / MOVE                            โ
โ  WORK                         โ  WORK / MOVE / HARVEST                     โ
โ  CRAFT                        โ  CRAFT / MOVE                              โ
โ  DEPOSIT                      โ  DEPOSIT / MOVE                            โ
โ  FLEE                         โ  MOVE (posiciรณn calculada para escapar)    โ
โ  ATTACK / COMBAT              โ  ATTACK / MOVE                             โ
โ  ASSIST                       โ  MOVE โ SOCIALIZE                          โ
โ  SOCIAL                       โ  SOCIALIZE / MOVE                          โ
โ  EXPLORE                      โ  MOVE                                      โ
โ  CONSTRUCTION                 โ  BUILD / WORK / MOVE                       โ
โ  IDLE                         โ  IDLE                                      โ
โ  REST                         โ  SLEEP / MOVE / IDLE                       โ
โ  INSPECT                      โ  MOVE                                      โ
โ  HUNT                         โ  ATTACK / MOVE                             โ
โ                                                                            โ
โ  LรGICA DE DISTANCIA:                                                     โ
โ  โโโ HARVEST_RANGE = 80     โ si dist < 80 ejecutar HARVEST               โ
โ  โโโ ATTACK_RANGE = 50      โ si dist < 50 ejecutar ATTACK                โ
โ  โโโ EXPLORE_RANGE = 200    โ rango de exploraciรณn                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ Flujo de Ejecuciรณn (AIActionExecutor)

```text
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     executeAction(action) โ void                           โ
โ                                                                            โ
โ  ACTION TYPE      โ  SISTEMA INVOLUCRADO    โ  EVENTO EMITIDO             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  MOVE             โ  MovementSystem          โ  AGENT_ACTION_COMPLETE      โ
โ  WORK             โ  TaskSystem              โ  AGENT_ACTION_COMPLETE      โ
โ  HARVEST          โ  WorldResourceSystem     โ  AGENT_ACTION_COMPLETE      โ
โ                   โ  NeedsSystem             โ  (satisface necesidad)      โ
โ                   โ  InventorySystem         โ  (aรฑade recursos)           โ
โ  IDLE             โ  NeedsSystem             โ  AGENT_ACTION_COMPLETE      โ
โ  ATTACK           โ  AnimalRegistry          โ  AGENT_ACTION_COMPLETE      โ
โ                   โ  CombatSystem            โ  COMBAT_HIT/KILL            โ
โ  SOCIALIZE        โ  SocialSystem            โ  AGENT_ACTION_COMPLETE      โ
โ  EAT              โ  NeedsSystem             โ  AGENT_ACTION_COMPLETE      โ
โ  DRINK            โ  NeedsSystem             โ  AGENT_ACTION_COMPLETE      โ
โ  SLEEP            โ  NeedsSystem             โ  AGENT_ACTION_COMPLETE      โ
โ  CRAFT            โ  CraftingSystem          โ  AGENT_ACTION_COMPLETE      โ
โ  DEPOSIT          โ  InventorySystem         โ  AGENT_ACTION_COMPLETE      โ
โ  BUILD            โ  BuildingSystem          โ  AGENT_ACTION_COMPLETE      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ก Sistema de Eventos (Event Flow)

```text
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                          EVENTOS CLAVE DE IA                               โ
โ                                                                            โ
โ  EMISIรN:                                                                 โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  AISystem.processAgent()                                                   โ
โ    โโโ AGENT_GOAL_CHANGED         (nuevo objetivo asignado)                โ
โ                                                                            โ
โ  AISystem.processAgent()                                                   โ
โ    โโโ AGENT_ACTION_COMMANDED     (acciรณn iniciada)                        โ
โ                                                                            โ
โ  MovementSystem.updateEntityMovement()                                     โ
โ    โโโ MOVEMENT_ARRIVED_AT_ZONE   (llegรณ a zona)                          โ
โ    โโโ AGENT_ACTION_COMPLETE      (movimiento completado)                  โ
โ                                                                            โ
โ  AIActionExecutor.executeHarvest()                                         โ
โ    โโโ AGENT_ACTION_COMPLETE      (cosecha completada)                     โ
โ                                                                            โ
โ  RECEPCIรN:                                                               โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  AISystem.handleActionComplete()                                           โ
โ    โ AGENT_ACTION_COMPLETE                                                 โ
โ    โ Limpia currentAction                                                  โ
โ    โ Evalรบa si completar/fallar objetivo                                   โ
โ                                                                            โ
โ  AISystem.notifyEntityArrived()                                            โ
โ    โ (llamado por otros sistemas cuando agente llega)                      โ
โ    โ Delega a AIZoneHandler                                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐งฌ Diagrama de Estado del Agente

```text
                    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ                                              โ
                    โผ                                              โ
              โโโโโโโโโโโโ                                         โ
              โ  IDLE    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
              โโโโโโฌโโโโโโ                                         โ
                   โ makeDecision()                                โ
                   โผ                                              โ
         โโโโโโโโโโโโโโโโโโโ                                       โ
         โ PLANNING GOALS  โ                                       โ
         โ (17 evaluadores)โ                                       โ
         โโโโโโโโโโฌโโโโโโโโโ                                       โ
                  โ goals.length > 0                               โ
                  โผ                                               โ
         โโโโโโโโโโโโโโโโโโโ                                       โ
         โ  GOAL ASSIGNED  โ                                       โ
         โ currentGoal set โ                                       โ
         โโโโโโโโโโฌโโโโโโโโโ                                       โ
                  โ planAction()                                   โ
                  โผ                                              โ
         โโโโโโโโโโโโโโโโโโโ                                       โ
         โ ACTION PLANNED  โ                                       โ
         โ currentAction   โ                                       โ
         โโโโโโโโโโฌโโโโโโโโโ                                       โ
                  โ executeAction()                                โ
                  โผ                                              โ
         โโโโโโโโโโโโโโโโโโโ                                       โ
         โ   EXECUTING     โ                                       โ
         โ (MOVE/HARVEST/  โ                                       โ
         โ  ATTACK/etc)    โ                                       โ
         โโโโโโโโโโฌโโโโโโโโโ                                       โ
                  โ AGENT_ACTION_COMPLETE                          โ
                  โผ                                              โ
    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                                โ
    โ   handleActionComplete()    โ                                โ
    โ                             โ                                โ
    โ  success? โโโบ completeGoal()โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    โ     โ                       โ
    โ     โโบ fail? โบ failGoal() โโโค
    โ                             โ
    โ  MOVE complete? โบ planNext โโค
    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```
apiVersion: 1

templates:
  - orgId: 1
    name: simulation-alert-template
    template: |
      {{ define "simulation.title" }}
      [{{ .Status | toUpper }}{{ if eq .Status "firing" }} x {{ .Alerts.Firing | len }}{{ end }}] {{ .GroupLabels.alertname }}
      {{ end }}

      {{ define "simulation.message" }}
      {{ if gt (len .Alerts.Firing) 0 }}
      ğŸ”¥ **FIRING ALERTS**
      {{ range .Alerts.Firing }}
      â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
      **{{ .Labels.alertname }}**
      â€¢ Severity: {{ .Labels.severity | toUpper }}
      â€¢ System: {{ .Labels.system }}
      â€¢ Summary: {{ .Annotations.summary }}
      â€¢ Details: {{ .Annotations.description }}
      â€¢ Started: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
      {{ end }}
      {{ end }}

      {{ if gt (len .Alerts.Resolved) 0 }}
      âœ… **RESOLVED ALERTS**
      {{ range .Alerts.Resolved }}
      â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
      **{{ .Labels.alertname }}**
      â€¢ Severity: {{ .Labels.severity }}
      â€¢ Resolved at: {{ .EndsAt.Format "2006-01-02 15:04:05" }}
      {{ end }}
      {{ end }}
      {{ end }}

      {{ define "simulation.emoji" }}
      {{ if eq .Status "firing" }}
        {{ if eq .CommonLabels.severity "critical" }}ğŸ”´{{ else if eq .CommonLabels.severity "warning" }}ğŸŸ¡{{ else }}ğŸ”µ{{ end }}
      {{ else }}
        âœ…
      {{ end }}
      {{ end }}

      {{ define "simulation.slack" }}
      {
        "attachments": [
          {
            "color": "{{ if eq .Status "firing" }}{{ if eq .CommonLabels.severity "critical" }}#FF0000{{ else }}#FFA500{{ end }}{{ else }}#00FF00{{ end }}",
            "title": "{{ template "simulation.title" . }}",
            "text": "{{ template "simulation.message" . }}",
            "footer": "Grafana Simulation Monitoring",
            "ts": {{ .GroupLabels.StartsAt.Unix }}
          }
        ]
      }
      {{ end }}
